# CPU의 작동 원리
> ALU와 제어장치
> 
> 레지스터
>
> 명령어 사이클과 인터럽트

<br/>

## ALU와 제어장치
![image](https://github.com/bono039/TIL/assets/67899934/feed4098-2a8e-42eb-92f1-df24228f8199)

<br/>

### 1. ALU : 계산 장치

![image](https://github.com/bono039/TIL/assets/67899934/b2755cfd-d76e-4817-8369-e3968685e25e)

- **받아들이는 정보** | 피연산자, 제어신호
- **내보내는 정보**     | 결괏값(숫자, 문자, 주소 등), 플래그(연산 결과에 대한 부가 정보)
<details>
<summary>플래그 레지스터</summary>
<div markdown="1">

![image](https://github.com/bono039/TIL/assets/67899934/bdee186d-9cde-46ed-9c45-a682f7e85824)
![image](https://github.com/bono039/TIL/assets/67899934/d827e626-a0fa-454a-b316-7b3cf0b8d0b3)


</div>
</details>


<br/>

### 2. 제어 장치 : 제어 신호 발생시키고 명령어 해석하는 장치
![image](https://github.com/bono039/TIL/assets/67899934/e1fde85f-2b07-46c2-a62b-43a0c64fea87)


- 받아들이는 정보
   1. <code>클럭</code> : 컴퓨터의 모든 부품을 일사불란하게 움직이게 하는 시간 단위
   2. 해석할 명렁어
   3. 플래그
   4. 제어 신호
- 내보내는 정보
   - CPU 내부(레지스터, ALU)에 전달하는 제어 신호
   - CPU 외부(메모리, 입출력장치)에 전달하는 제어 신호

<br/>

## 레지스터
 ```
 CPU 내부의 작은 임시 저장 장치
```
- 프로그램 속 명렁어,데이터는 실행 전후로 레지스터에 저장

<br/>

### 반드시 알아야 할 레지스터 ⭐
1. **프로그램 카운터**           : 메모리에서 가져올(=읽어들일) 명령어 주소. 프로그램 실행하면서 1씩 증가
![image](https://github.com/bono039/TIL/assets/67899934/24b98075-9023-4229-9b90-af022829ff88)


2. **메모리 주소 레지스터**   : 메모리 주소 저장 ← _주소 버스_

3. **메모리 버퍼 레지스터**   : 메모리와 주고받을 값 (데이터,명령어) ← _데이터 버스_
![image](https://github.com/bono039/TIL/assets/67899934/875ad74a-1c92-41f6-bd7d-3568b2608278)


4. **명령어 레지스터**           : 해석할 명령어 (방금 메모리에서 읽어들인 명령어)
![image](https://github.com/bono039/TIL/assets/67899934/6599aa44-27d7-4633-9c84-0734b5ffea84)

   ➕ 순차적 실행 흐름 끊기는 경우
   > - 인터럽트 발생 시
   > - 특정 메모리 주소로 실행 흐름 이동하는 명령어 실행 시 (예 : JUMP, CONDITIONAL JUMP, CALL, RET)

<br/>

5. **플래그 레지스터** : 연산 결과 / CPU 상태에 대한 부가 정보

6. **범용 레지스터**     : 다양하고 일반적 상황에서 자유롭게 사용

7. **스택 포인터**         : 스택 꼭대기 가리키는 레지스터<br/>&nbsp; → **_스택 주소 지정 방식_** : 스택과 스택 포인터 이용

8. **베이스 레지스터**  : 기준 주소 저장<br/>&nbsp; → **_변위 주소 지정 방식_** : 오퍼랜드 필드 값(변위)과 **특정 레지스터** 값 **더해** 유효 주소 얻기
![image](https://github.com/user-attachments/assets/aa26b9d7-56d8-46b5-bda2-c8a5c76a5b3d)

   1. **상대 주소 지정 방식** : 오퍼랜드 필드 값(변위)과 **프로그램 카운터 값** 더해 유효 주소 얻기
      ![image](https://github.com/user-attachments/assets/11b01c26-00a9-4356-8252-a32cb8c66814)
   2. **베이스 레지스터 주소 지정 방식** : 오퍼랜드 필드 값(변위)과 **베이스 레지스터 값** 더해 유효 주소 얻기
      ![image](https://github.com/user-attachments/assets/2f54dd4c-8499-4921-8206-eac3af131318)

<br/>

## 명령어 사이클과 인터럽트
### 명령어 사이클
 ```
 CPU에서 실행되는 정해진 흐름, 일정한 주기
 ```

![image](https://github.com/user-attachments/assets/1fb2af51-07b6-4e56-b5e6-484a0260ad22)
<br/>
  1. **인출 사이클** : 가장 먼저 CPU로 가져와야 함<br/>![image](https://github.com/user-attachments/assets/e59208fd-b354-4e8c-b3c3-ec51fb807f93)

  2. **실행 사이클** : 갖고 왔으면 실행<br/>![image](https://github.com/user-attachments/assets/abf73e47-bf1b-4989-898f-10a8936e988d)
  3. **간접 사이클** : 메모리 접근이 더 필요한 경우
  4. **인터럽트 사이클** : 인터럽트가 발생한 경우

<br/>

### 인터럽트
 ```
 CPU가 꼭 주목해야 하거나 얼른 처리해야 할 다른 작업이 생겼을 때, 정해진 신호를 끊는 신호
  ```
![image](https://github.com/user-attachments/assets/bf260c8c-37c5-4a45-8a77-73602299231d)

> **_'CPU가 인터럽트 처리한다'_** <br/> 
> = 인터럽트 서비스 루틴을 실행하고, 본래 수행하던 작업으로 되돌아온다
> 
>    (+ 인터럽트 시작 주소는 인터럽트 벡터 통해 확인 가능)

<br/>

#### 1. 동기 인터럽트 (예외)
- CPU가 예기치 못한 상황 접했을 때 발생
- **종류** : 폴트, 트랩, 중단, SW 인터럽트

#### 2. 비동기 인터럽트 (HW 인터럽트)
- 입출력 작업 도중 효율적으로 명령어 처리하기 위해 사용
- (= 알림) 인터럽트 있다면, 입출력 작업하는 동안 다른 일 수행 가능
- **종류** : 인터럽트 플래그로 막을 수 [있는 / 없는] 인터럽트
   
- #### HW 인터럽트 처리 순서
   1. 입출력 장치, CPU에 ```인터럽트 요청 신호``` 보냄
   
   2. CPU, 실행 사이클 끝나고 명령어 인출하기 전 항상 인터럽트 여부 확인
   
   3. CPU, 인터럽트 요청 확인하고  ```인터럽트 플래그``` 통해 현재 인터럽트 받아들일 수 있는지 여부 확인
   
   4. 인터럽트 받아들일 수 있다면, CPU는 지금까지의 작업 백업
   
   5. CPU,  ```인터럽트 벡터``` 참조해  ```인터럽트 서비스 루틴``` 실행
   ![image](https://github.com/user-attachments/assets/fd477a08-961b-4971-9d00-ee5cd13ec5e4)
   
   6. 인터럽트 서비스 루틴 실행 끝나면, 4에서 백업해둔 작업 복구해 실행 재개
   
   
   > * **인터럽트 요청 신호**     : CPU의 작업 방해하는 인터럽트에 대한 요청<br/> * **인터럽트 플래그**         : 인터럽트 요청 신호 수용할지 무시할지 결정하는 비트<br/> * **인터럽트 벡터**            : 각 인터럽트 구분 위한 정보. 인터럽트 서비스 루틴의 시작 주소를 포함하는 인터럽트 서비스 루틴 식별 정보<br/> * **인터럽트 서비스 루틴** : 인터럽트 처리 프로그램

<br/>

#### 🔗 참고
* [[컴퓨터 공학 기초 강의] 9강. CPU의 내부 구성 - ALU와 제어장치](https://youtu.be/lehWiAsIDrQ?feature=shared)
* [[컴퓨터 공학 기초 강의] 10강. CPU의 내부 구성 - 레지스터](https://youtu.be/fSCHizcezTs?feature=shared)
* [[컴퓨터 공학 기초 강의] 11강. 명령어 사이클과 인터럽트](https://youtu.be/3Yz7OnVUM28?feature=shared)
